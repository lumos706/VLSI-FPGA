# 实验1——进阶

<mark>注意：进阶要求是面向大作业的，同学们选择划分作为大作业内容时，可以选择完成以下提到的要求。</mark><br>
<mark>注意：连同代码和论文一起提交，并且写一个简要的README文件，说明如何复现你的实验结果。</mark><br>
在这个实验中，你需要实现一个partition算法。

## 1. 并行化你的划分算法

改造实验一中实现的算法，使得它适应多线程计算。

在大作业论文中，你需要说明你的并行化思路，以及并行化的加速比。

## 2. 多路划分

改造实验一中的算法，使得它适应多路划分。

在大作业论文中，你需要简要说明你的算法思路。

* (可选)你的程序允许设置划分均衡的参数$r\in[0,1/n]$，其中$n$是划分的数量，要求每个划分，被分配的元件数量占全部元件数量的比例不小于$r$。
  * 你需要特别注意当$r\times n=1$时，你的程序不能崩溃或无法完成任务。
  * 如果总元件数量不可以被$n$整除，允许节点之间的元件数量相差1（例如$r=0.5$，但是元件总数量为奇数个）。

## 3. 拓扑约束
### 问题描述

给定一个网表和划分的目标对象，你需要最小化多个划分之间的割代价，同时尽可能保证多个划分的平衡。
为了降低实验难度，我们将原问题的超图降低为普通图，即每一条连接$n$个顶点的超边，我们用$n-1$条边来代替。

### 输入文件说明

数据集下载链接：[校内链接](http://172.18.233.211:5244/d/VLSI%E8%AF%BE%E4%BB%B6/dataset/ICCAD2021-TopoPart-Benchmarks.zip?sign=LOFu8O027JQdt1pLv3s4yx3-PYj48w3_ajw2ZhQx274=:0)和[校外链接(Google Drive)](https://drive.google.com/drive/folders/14cXR0dZA-3H5BY0BcZ6KFvDf4E1NeTon)。

`ICCAD2021-TopoPart-Benchmarks.zip`输入包含三个文件，文件`FPGA Graph.zip`是划分的拓扑信息，`Generated Benchmarks.zip`和`Titan23 Benchmarks.zip`是网表相关信息。

#### 划分拓扑信息

你将会见到的划分拓扑信息如下：

```text
8 11
0 1
0 4
0 6
1 2
1 5
1 6
2 7
3 7
4 5
5 6
6 7
```

1. 第一行两个数字分别代表拓扑图的节点数和边数。例如这个图有8个节点，11条边。
2. 接下来的每一行代表一条边，每一行两个数字代表这条边的两个端点编号。例如这张图的边有11条，文件有11行。

如果我们把以上信息画成图，我们可以得到以下的结果：

<img width=400 alt="1" src="/lab1/./img/topo-MFS1.png" style="margin: auto; display: flex;">

#### 网表相关信息

你将会见到的网表相关信息如下：

```text
300000
749091
212496 250542
85805 88841
4047 221825
99901 129256
215074 8529
200758 78824
128700 186666
276356 131687
...
# 从749093行开始
3847 67234 98456
12345 67890
...
```

1. 第一行一个数字代表网表的节点数。例如这个图有300000个节点。
2. 第二行一个数字代表网表的边数。例如这个图有749091条边。
3. 接下来的每一行代表一条边，每一行两个数字代表这条边的两个端点编号。例如这张图的边有749091条，除去最开始的两行，文件还有749091行。

<mark>注意：生成测试数据集时使用`MFS2`的拓朴图，如果要迁移到`MFS1`上，你需要忽略倒数35行的数据。</mark>

<mark>你必须先实现**多路划分**，才能实现拓扑约束任务。</mark>

### 约束说明

以`MSF1`的拓朴图为例。假设元件0和元件1相连、元件2和元件3相连。且划分算法把他们按照以下示例图所示的位置进行划分。

<img width=400 alt="1" src="/lab1/./img/topo-MFS1-error.png" style="margin: auto; display: flex;">

此时元件1和元件0被划分到节点0和节点4，而节点1和4之间存在直接连接的关系，我们称元件0和元件1是满足拓扑约束的。<br>
相反，元件2和元件3被划分到节点0和节点5，而节点0和5之间不存在直接连接的关系，我们称元件2和元件3是不满足拓扑约束的。

## 4. 固定约束

[3-拓扑约束](#2-多路划分)一节样例数据集。从第749093行位置开始，每一行代表代表固定节点的信息。第一行有三个数字，分别代表3847、67234、98456三个元件固定在拓朴图的节点0上。第二行有两个数字，分别代表12345、67890两个元件固定在拓朴图的节点1上。助教们会保证拓朴图的每个节点都至少有一个元件固定。

以`MSF1`的拓朴图为例。假设元件1和元件2被固定在节点0上，那么你的算法输出时，元件1和元件2必须被划分到节点0上。